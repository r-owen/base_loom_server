<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Coding - Base Loom Server</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Base Loom Server</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../weaving/" class="nav-link">Weaving</a>
                            </li>
                            <li class="nav-item">
                                <a href="../threading/" class="nav-link">Threading</a>
                            </li>
                            <li class="nav-item">
                                <a href="../installing/" class="nav-link">Installing</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Coding</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../installing/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#coding" class="nav-link">Coding</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#installing-source-code" class="nav-link">Installing Source Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#writing-a-loom-server" class="nav-link">Writing a Loom Server</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="coding">Coding</h1>
<h2 id="installing-source-code">Installing Source Code</h2>
<ul>
<li>
<p>Install Python as explained in <a href="../installing/">Installing</a>.</p>
</li>
<li>
<p>Download the source code from <a href="https://github.com/r-owen/base_loom_server.git">github</a>,
  or make a fork and git clone that.</p>
</li>
<li>
<p>Inside the directory, do the following:</p>
<ul>
<li>Make "editable installation" of the package.
  An editable installation runs from the source code,
  so changes you make to the source are used when you run or test the code,
  without the need to reinstall the package:<pre><code>pip install -e .'[dev]'
</code></pre>
</li>
</ul>
<p>where the single quotes around <code>[dev]</code> are required in zsh, but not in bash.
  <code>'[dev]'</code> installs development-related packages such as pytest
  (see the file <code>pyproject.toml</code> for the full list).</p>
<ul>
<li>
<p>Activate the pre-commit hooks:</p>
<pre><code>pre-commit install
</code></pre>
</li>
<li>
<p>Run unit tests to test your installation:</p>
<pre><code>pytest
</code></pre>
</li>
</ul>
</li>
<li>
<p>You may run an example loom server with:</p>
<pre><code>run_example_loom mock
</code></pre>
</li>
</ul>
<p>Please only specify the <strong>mock</strong> serial port; connecting it to a real loom will not work
  (<code>ExampleMockLoom</code> is loosely based on a SÃ©guin loom, but is not compatible).</p>
<p><code>run_example_loom mock</code> also accepts these command-line arguments:</p>
<pre><code>* `--reset-db` Reset the pattern database. Try this if you think the database is corrupted.

* `--verbose` Print more diagnostic information.
</code></pre>
<p>Note that the example loom server uses the same pattern database as
  <a href="https://pypi.org/project/seguin-loom-server/">seguin_loom_server</a>
  and <a href="https://pypi.org/project/toika-loom-server/">toika_loom_server</a>.</p>
<ul>
<li>
<p>To run mypy run:</p>
<pre><code>MYPYPATH=src mypy .
</code></pre>
<p>This avoids complaints about module name ambiguity.</p>
</li>
<li>
<p>In mock mode the web page shows a few extra controls for debugging.</p>
</li>
<li>
<p>Warning: the web server's automatic reload feature, which reloads Python code whenever you save changes,
  <em>does not work</em> with this software.
  Instead you have to kill the web server by typing control-C several times, until you get a terminal prompt, then run the server again.
  This may be a bug in uvicorn; see <a href="https://github.com/encode/uvicorn/discussions/2075">this discussion</a> for more information.</p>
</li>
</ul>
<h2 id="writing-a-loom-server">Writing a Loom Server</h2>
<ul>
<li>
<p>Install the <code>base_loom_server</code> package either using pip, or from source (as described above).
  Source makes it easier to look through the code.</p>
</li>
<li>
<p>Write a subclass of <code>BaseMockLoom</code> that emulates your loom.
  Two examples are <code>ExampleMockLoom</code> in this package and <code>MockLoom</code>
  in <a href="https://pypi.org/project/toika-loom-server/">toika_loom_server</a>.</p>
</li>
<li>
<p>Write a subclass of <code>BaseLoomServer</code> that talks to the loom.
  Two examples are <code>ExampleLoomServer</code> in this package and <code>LoomServer</code>
  in <a href="https://pypi.org/project/toika-loom-server/">toika_loom_server</a>.</p>
</li>
<li>
<p>Write a <code>main.py</code> like the one in this package, to run your loom server.</p>
</li>
<li>
<p>Copy <code>tests/test_mock_loom.py</code> and modify it to suit your mock loom.</p>
</li>
<li>
<p>The unit tests for your loom server should be able to use <code>testutils.BaseTestLoomServer</code>, as <code>tests/test_loom_server.py</code> does.</p>
</li>
<li>
<p>Write a <code>pyproject.toml</code> like the one for <a href="https://pypi.org/project/toika-loom-server/">toika_loom_server</a>.</p>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
